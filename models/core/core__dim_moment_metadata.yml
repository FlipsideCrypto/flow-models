version: 2

models:
  - name: core__dim_moment_metadata
    description: |-
      NFT Moment Metadata scraped from on-chain activity, where available. This should be joinable on sales or mints using the nft_collection (event_contract) and nft id.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - nft_collection
            - nft_id

    columns:
      - name: NFT_COLLECTION
        description: "{{ doc('nft_collection') }}"
        tests:
          - not_null
      - name: nft_id
        description: "{{ doc('nft_id') }}"
        tests:
          - not_null
      - name: serial_number
        description: "{{ doc('serial_number') }}"
        tests:
          - not_null
      - name: max_mint_size
        description: "{{ doc('max_mint_size') }}"
        tests:
          - not_null:
              where: NFT_COLLECTION != 'A.0b2a3299cc857e29.TopShot'
      - name: play_id
        description: "{{ doc('play_id') }}"
        tests:
          - not_null
      - name: series_id
        description: "{{ doc('series_id') }}"
        tests:
          - not_null:
              where: NFT_COLLECTION != 'A.0b2a3299cc857e29.TopShot'
      - name: series_name
        description: "{{ doc('series_name') }}"
        tests:
          - not_null:
              where: NFT_COLLECTION != 'A.0b2a3299cc857e29.TopShot'
      - name: set_id
        description: "{{ doc('set_id') }}"
        tests:
          - not_null
      - name: set_name
        description: "{{ doc('set_name') }}"
        tests:
          - not_null:
              where: NFT_COLLECTION != 'A.0b2a3299cc857e29.TopShot'
      - name: edition_id
        description: "{{ doc('edition_id') }}"
        tests:
          - not_null:
              where: NFT_COLLECTION != 'A.0b2a3299cc857e29.TopShot'
      - name: edition_name
        description: "{{ doc('edition_name') }}"
      - name: tier
        description: "{{ doc('tier') }}"
        tests:
          - not_null:
              where: NFT_COLLECTION != 'A.0b2a3299cc857e29.TopShot'
      - name: metadata
        description: "{{ doc('metadata') }}"
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_type_list:
              column_type_list:
                - VARIANT
                - OBJECT
